!function(E,R){"object"==typeof exports&&"undefined"!=typeof module?R(exports):"function"==typeof define&&define.amd?define(["exports"],R):R((E="undefined"!=typeof globalThis?globalThis:E||self).HEIMDALLR_CORE={})}(this,(function(E){"use strict";var R,t=((R=t||{}).NAME="@heimdallr-sdk",R);const O="[@heimdallr-sdk]:";var e=(E=>(E[E.FATAL=1]="FATAL",E[E.ERROR=2]="ERROR",E[E.WARN=3]="WARN",E[E.INFO=4]="INFO",E[E.DEBUG=5]="DEBUG",E))(e||{}),s=(E=>(E.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",E.USER_ID="HEIMDALLR_SDK_USER_ID",E.APP="HEIMDALLR_SDK_APP_ID",E))(s||{}),C=(E=>(E.GET="GET",E.POST="POST",E.PUT="PUT",E.DELETE="DELETE",E))(C||{}),o=(E=>(E[E.LIFECYCLE=1]="LIFECYCLE",E[E.ERROR=2]="ERROR",E[E.PERFORMANCE=3]="PERFORMANCE",E[E.API=4]="API",E[E.DOM=5]="DOM",E[E.ROUTE=6]="ROUTE",E[E.CONSOLE=7]="CONSOLE",E[E.RECORD=8]="RECORD",E[E.VUE=9]="VUE",E[E.CUSTOMER=10]="CUSTOMER",E[E.EXTEND=11]="EXTEND",E))(o||{}),i=(E=>(E[E.CODEERROR=21]="CODEERROR",E[E.RESOURCEERROR=22]="RESOURCEERROR",E[E.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",E[E.PAGECRASH=24]="PAGECRASH",E))(i||{}),n=(E=>(E[E.BEACON=1]="BEACON",E[E.IMG=2]="IMG",E[E.GET=3]="GET",E[E.POST=4]="POST",E))(n||{}),r=(E=>(E[E.CLICK=51]="CLICK",E))(r||{}),S=(E=>(E.LOG="log",E.INFO="info",E.WARN="warn",E.ERROR="error",E.ASSERT="assert",E))(S||{}),L=(E=>(E[E.XHR=41]="XHR",E[E.FETCH=42]="FETCH",E))(L||{}),a=(E=>(E[E.FMP=31]="FMP",E[E.FPS=32]="FPS",E[E.BASIC=33]="BASIC",E[E.VITALS=34]="VITALS",E[E.RESOURCE=35]="RESOURCE",E))(a||{}),A=(E=>(E[E.HASH=61]="HASH",E[E.HISTORY=62]="HISTORY",E))(A||{}),T=(E=>(E[E.CUSTOMER=111]="CUSTOMER",E))(T||{}),I=(E=>(E.LOCAL="local",E.SESSION="session",E.COOKIE="cookie",E.GLOBAL="global",E))(I||{}),c=(E=>(E[E.LOAD=11]="LOAD",E[E.UNLOAD=12]="UNLOAD",E))(c||{}),D=(E=>(E[E.MOBILE=1]="MOBILE",E[E.PC=2]="PC",E))(D||{}),h=(E=>(E[E.BROWSER=1]="BROWSER",E[E.WECHAT=2]="WECHAT",E[E.NODE=3]="NODE",E))(h||{}),l=(E=>(E[E.ROUTE=11]="ROUTE",E[E.CLICK=12]="CLICK",E[E.CONSOLE=13]="CONSOLE",E[E.XHR=14]="XHR",E[E.FETCH=15]="FETCH",E[E.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",E[E.RESOURCE=17]="RESOURCE",E[E.CODE_ERROR=18]="CODE_ERROR",E[E.CUSTOMER=19]="CUSTOMER",E[E.FRAMEWORK=20]="FRAMEWORK",E[E.LIFECYCLE=21]="LIFECYCLE",E[E.CRASH=22]="CRASH",E))(l||{}),N=(E=>(E[E.API=21]="API",E[E.ROUTE=22]="ROUTE",E[E.CLICK=23]="CLICK",E[E.ERROR=24]="ERROR",E[E.LIFECYCLE=25]="LIFECYCLE",E[E.CUSTOMER=26]="CUSTOMER",E))(N||{});const U=(E,R)=>`${/^http(s|):\/\//.test(E||"")?E:`//${(E||"").replace(/^http(s|):\/\//,"")}`}/${"/"===(R||"")[0]?R.substring(1):R}`;var p,u,H=((p=H||{}).NAME="@heimdallr-sdk",p),P=((u=P||{})[u.FATAL=1]="FATAL",u[u.ERROR=2]="ERROR",u[u.WARN=3]="WARN",u[u.INFO=4]="INFO",u[u.DEBUG=5]="DEBUG",u),d=(E=>(E.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",E.USER_ID="HEIMDALLR_SDK_USER_ID",E.APP="HEIMDALLR_SDK_APP_ID",E))(d||{}),M=(E=>(E.GET="GET",E.POST="POST",E.PUT="PUT",E.DELETE="DELETE",E))(M||{}),F=(E=>(E[E.LIFECYCLE=1]="LIFECYCLE",E[E.ERROR=2]="ERROR",E[E.PERFORMANCE=3]="PERFORMANCE",E[E.API=4]="API",E[E.DOM=5]="DOM",E[E.ROUTE=6]="ROUTE",E[E.CONSOLE=7]="CONSOLE",E[E.RECORD=8]="RECORD",E[E.VUE=9]="VUE",E[E.CUSTOMER=10]="CUSTOMER",E[E.EXTEND=11]="EXTEND",E))(F||{}),f=(E=>(E[E.CODEERROR=21]="CODEERROR",E[E.RESOURCEERROR=22]="RESOURCEERROR",E[E.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",E[E.PAGECRASH=24]="PAGECRASH",E))(f||{}),b=(E=>(E[E.BEACON=1]="BEACON",E[E.IMG=2]="IMG",E[E.GET=3]="GET",E[E.POST=4]="POST",E))(b||{}),_=(E=>(E[E.CLICK=51]="CLICK",E))(_||{}),m=(E=>(E.LOG="log",E.INFO="info",E.WARN="warn",E.ERROR="error",E.ASSERT="assert",E))(m||{}),B=(E=>(E[E.XHR=41]="XHR",E[E.FETCH=42]="FETCH",E))(B||{}),g=(E=>(E[E.FMP=31]="FMP",E[E.FPS=32]="FPS",E[E.BASIC=33]="BASIC",E[E.VITALS=34]="VITALS",E[E.RESOURCE=35]="RESOURCE",E))(g||{}),y=(E=>(E[E.HASH=61]="HASH",E[E.HISTORY=62]="HISTORY",E))(y||{}),G=(E=>(E[E.CUSTOMER=111]="CUSTOMER",E))(G||{}),K=(E=>(E.LOCAL="local",E.SESSION="session",E.COOKIE="cookie",E.GLOBAL="global",E))(K||{}),k=(E=>(E[E.LOAD=11]="LOAD",E[E.UNLOAD=12]="UNLOAD",E))(k||{}),W=(E=>(E[E.MOBILE=1]="MOBILE",E[E.PC=2]="PC",E))(W||{}),Y=(E=>(E[E.BROWSER=1]="BROWSER",E[E.WECHAT=2]="WECHAT",E[E.NODE=3]="NODE",E))(Y||{}),x=(E=>(E[E.ROUTE=11]="ROUTE",E[E.CLICK=12]="CLICK",E[E.CONSOLE=13]="CONSOLE",E[E.XHR=14]="XHR",E[E.FETCH=15]="FETCH",E[E.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",E[E.RESOURCE=17]="RESOURCE",E[E.CODE_ERROR=18]="CODE_ERROR",E[E.CUSTOMER=19]="CUSTOMER",E[E.FRAMEWORK=20]="FRAMEWORK",E[E.LIFECYCLE=21]="LIFECYCLE",E[E.CRASH=22]="CRASH",E))(x||{}),w=(E=>(E[E.API=21]="API",E[E.ROUTE=22]="ROUTE",E[E.CLICK=23]="CLICK",E[E.ERROR=24]="ERROR",E[E.LIFECYCLE=25]="LIFECYCLE",E[E.CUSTOMER=26]="CUSTOMER",E))(w||{});class v{constructor(){this.dep=new Map}watch(E,R){const t=this.dep.get(E);t?this.dep.set(E,t.concat(R)):this.dep.set(E,[R])}notify(E,R){const t=this.dep.get(E);E&&t&&t.forEach((E=>{try{E(R)}catch(E){console.error(E)}}))}}var X=Object.defineProperty,J=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable,Q=(E,R,t)=>R in E?X(E,R,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[R]=t,$=(E,R)=>{for(var t in R||(R={}))V.call(R,t)&&Q(E,t,R[t]);if(J)for(var t of J(R))j.call(R,t)&&Q(E,t,R[t]);return E};E.Breadcrumb=class{constructor(E={}){this.maxBreadcrumbs=E.maxBreadcrumbs||80,this.stack=[]}unshift(E){return E.l||(E.l=e.INFO),this.stack.length>=this.maxBreadcrumbs&&this.pop(),this.stack.unshift(E),this.stack.sort(((E,R)=>R.t-E.t)),this.stack}pop(){return void 0!==this.stack.pop()}clear(){this.stack=[]}getStack(){return this.stack.slice(0)}},E.Core=class{constructor(E){this.options=E,this.initConsole(),this.isRightEnv()?(this.bindOptions(),this.isReady=!1,this.taskQueue=[],this.initAPP().then((E=>{E&&this.appID!==E&&(this.appID=E),this.isReady=!0,this.executeTaskQueue()}))):console.warn(O,"Client does not match the environment")}initConsole(){const{debug:E}=this.options;E&&"undefined"!=typeof console||Object.keys(S).forEach((E=>{console[E]=()=>null}))}bindOptions(){const{dsn:E,app:R,debug:t=!1,enabled:e=!0}=this.options;if(!R||!E)return void console.warn(O,"Missing app or dsn in options");const{host:s,init:C,report:o=""}=E,i=U(s,C),n=U(s,o);this.context={app:R,uploadUrl:n,initUrl:i,debug:t,enabled:e}}use(E){const{uploadUrl:R,enabled:t}=this.context,O=new v,e=new Map;for(const s of E){const{name:E,monitor:C,transform:o}=s||{};if(!E||!C){console.warn("The plugin missing name or monitor.");continue}if(e.has(E)){console.warn(`The plugin name [${E}] is duplicate, please modify it.`);continue}e.set(E,1);try{C.call(this,O.notify.bind(O,E))}catch(E){console.error(E)}const i=(...E)=>{const O="function"==typeof o?o.apply(this,E):E;if(!O)return;const e=this.transform(O);e&&t&&(this.isReady?this.nextTick(this.report,this,R,$({aid:this.appID},e)):this.taskQueue.push(e))};O.watch(E,i)}}executeTaskQueue(){const{uploadUrl:E}=this.context;for(;this.taskQueue.length;){const R=this.taskQueue.shift();this.nextTick(this.report,this,E,$({aid:this.appID},R))}}getClientOptions(){return $({},this.options)}getContext(){return $({},this.context)}},Object.defineProperty(E,"__esModule",{value:!0})}));
