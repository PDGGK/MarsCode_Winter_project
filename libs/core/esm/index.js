import{formateUrlPath as t}from"@heimdallr-sdk/utils";var s,e=((s=e||{}).NAME="@heimdallr-sdk",s);const E="[@heimdallr-sdk]:";var i=(t=>(t[t.FATAL=1]="FATAL",t[t.ERROR=2]="ERROR",t[t.WARN=3]="WARN",t[t.INFO=4]="INFO",t[t.DEBUG=5]="DEBUG",t))(i||{}),o=(t=>(t.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",t.USER_ID="HEIMDALLR_SDK_USER_ID",t.APP="HEIMDALLR_SDK_APP_ID",t))(o||{}),n=(t=>(t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t))(n||{}),R=(t=>(t[t.LIFECYCLE=1]="LIFECYCLE",t[t.ERROR=2]="ERROR",t[t.PERFORMANCE=3]="PERFORMANCE",t[t.API=4]="API",t[t.DOM=5]="DOM",t[t.ROUTE=6]="ROUTE",t[t.CONSOLE=7]="CONSOLE",t[t.RECORD=8]="RECORD",t[t.VUE=9]="VUE",t[t.CUSTOMER=10]="CUSTOMER",t[t.EXTEND=11]="EXTEND",t))(R||{}),r=(t=>(t[t.CODEERROR=21]="CODEERROR",t[t.RESOURCEERROR=22]="RESOURCEERROR",t[t.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",t[t.PAGECRASH=24]="PAGECRASH",t))(r||{}),O=(t=>(t[t.BEACON=1]="BEACON",t[t.IMG=2]="IMG",t[t.GET=3]="GET",t[t.POST=4]="POST",t))(O||{}),a=(t=>(t[t.CLICK=51]="CLICK",t))(a||{}),c=(t=>(t.LOG="log",t.INFO="info",t.WARN="warn",t.ERROR="error",t.ASSERT="assert",t))(c||{}),C=(t=>(t[t.XHR=41]="XHR",t[t.FETCH=42]="FETCH",t))(C||{}),h=(t=>(t[t.FMP=31]="FMP",t[t.FPS=32]="FPS",t[t.BASIC=33]="BASIC",t[t.VITALS=34]="VITALS",t[t.RESOURCE=35]="RESOURCE",t))(h||{}),l=(t=>(t[t.HASH=61]="HASH",t[t.HISTORY=62]="HISTORY",t))(l||{}),p=(t=>(t[t.CUSTOMER=111]="CUSTOMER",t))(p||{}),S=(t=>(t.LOCAL="local",t.SESSION="session",t.COOKIE="cookie",t.GLOBAL="global",t))(S||{}),u=(t=>(t[t.LOAD=11]="LOAD",t[t.UNLOAD=12]="UNLOAD",t))(u||{}),I=(t=>(t[t.MOBILE=1]="MOBILE",t[t.PC=2]="PC",t))(I||{}),T=(t=>(t[t.BROWSER=1]="BROWSER",t[t.WECHAT=2]="WECHAT",t[t.NODE=3]="NODE",t))(T||{}),A=(t=>(t[t.ROUTE=11]="ROUTE",t[t.CLICK=12]="CLICK",t[t.CONSOLE=13]="CONSOLE",t[t.XHR=14]="XHR",t[t.FETCH=15]="FETCH",t[t.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",t[t.RESOURCE=17]="RESOURCE",t[t.CODE_ERROR=18]="CODE_ERROR",t[t.CUSTOMER=19]="CUSTOMER",t[t.FRAMEWORK=20]="FRAMEWORK",t[t.LIFECYCLE=21]="LIFECYCLE",t[t.CRASH=22]="CRASH",t))(A||{}),L=(t=>(t[t.API=21]="API",t[t.ROUTE=22]="ROUTE",t[t.CLICK=23]="CLICK",t[t.ERROR=24]="ERROR",t[t.LIFECYCLE=25]="LIFECYCLE",t[t.CUSTOMER=26]="CUSTOMER",t))(L||{});class D{constructor(){this.dep=new Map}watch(t,s){const e=this.dep.get(t);e?this.dep.set(t,e.concat(s)):this.dep.set(t,[s])}notify(t,s){const e=this.dep.get(t);t&&e&&e.forEach((t=>{try{t(s)}catch(t){console.error(t)}}))}}var d=Object.defineProperty,U=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,P=(t,s,e)=>s in t?d(t,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[s]=e,H=(t,s)=>{for(var e in s||(s={}))N.call(s,e)&&P(t,e,s[e]);if(U)for(var e of U(s))f.call(s,e)&&P(t,e,s[e]);return t};class M{constructor(t){this.options=t,this.initConsole(),this.isRightEnv()?(this.bindOptions(),this.isReady=!1,this.taskQueue=[],this.initAPP().then((t=>{t&&this.appID!==t&&(this.appID=t),this.isReady=!0,this.executeTaskQueue()}))):console.warn(E,"Client does not match the environment")}initConsole(){const{debug:t}=this.options;t&&"undefined"!=typeof console||Object.keys(c).forEach((t=>{console[t]=()=>null}))}bindOptions(){const{dsn:s,app:e,debug:i=!1,enabled:o=!0}=this.options;if(!e||!s)return void console.warn(E,"Missing app or dsn in options");const{host:n,init:R,report:r=""}=s,O=t(n,R),a=t(n,r);this.context={app:e,uploadUrl:a,initUrl:O,debug:i,enabled:o}}use(t){const{uploadUrl:s,enabled:e}=this.context,E=new D,i=new Map;for(const o of t){const{name:t,monitor:n,transform:R}=o||{};if(!t||!n){console.warn("The plugin missing name or monitor.");continue}if(i.has(t)){console.warn(`The plugin name [${t}] is duplicate, please modify it.`);continue}i.set(t,1);try{n.call(this,E.notify.bind(E,t))}catch(t){console.error(t)}const r=(...t)=>{const E="function"==typeof R?R.apply(this,t):t;if(!E)return;const i=this.transform(E);i&&e&&(this.isReady?this.nextTick(this.report,this,s,H({aid:this.appID},i)):this.taskQueue.push(i))};E.watch(t,r)}}executeTaskQueue(){const{uploadUrl:t}=this.context;for(;this.taskQueue.length;){const s=this.taskQueue.shift();this.nextTick(this.report,this,t,H({aid:this.appID},s))}}getClientOptions(){return H({},this.options)}getContext(){return H({},this.context)}}class m{constructor(t={}){this.maxBreadcrumbs=t.maxBreadcrumbs||80,this.stack=[]}unshift(t){return t.l||(t.l=i.INFO),this.stack.length>=this.maxBreadcrumbs&&this.pop(),this.stack.unshift(t),this.stack.sort(((t,s)=>s.t-t.t)),this.stack}pop(){return void 0!==this.stack.pop()}clear(){this.stack=[]}getStack(){return this.stack.slice(0)}}export{m as Breadcrumb,M as Core};
