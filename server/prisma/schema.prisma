datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model Event {
  id          Int      @id @default(autoincrement())
  eventName   String
  projectId   String
  userId      String
  params      String?
  environment String?
  createdAt   DateTime @default(now())

  @@index([projectId, eventName])
  @@index([createdAt])
  @@index([userId])
}

model Project {
  id          Int      @id @default(autoincrement())
  name        String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([name])
}

model AlertRule {
  id             Int           @id @default(autoincrement())
  name           String
  type           String        // error, performance, custom
  condition      String
  threshold      Float
  status         Boolean       @default(true)
  notifyChannels String        // JSON string of channels array
  emailReceivers String        // JSON string of email addresses array
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  alertHistory   AlertHistory[]

  @@index([type])
  @@index([status])
}

model AlertHistory {
  id          Int       @id @default(autoincrement())
  ruleId      Int
  rule        AlertRule @relation(fields: [ruleId], references: [id])
  message     String
  status      String    // triggered, resolved
  triggeredAt DateTime  @default(now())
  resolvedAt  DateTime?
  
  @@index([ruleId])
  @@index([status])
  @@index([triggeredAt])
} 