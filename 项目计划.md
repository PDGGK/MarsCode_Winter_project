---

### **极简版埋点系统方案：heimdallr-sdk + Ant Design Pro（2 周内上线）**

---

#### **一、技术选型**
| **模块**        | **技术方案**                                                                 | **理由**                                                                 |
|-----------------|----------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **埋点 SDK**     | 直接使用 [heimdallr-sdk](https://github.com/heimdallr-sdk/heimdallr)       | 开箱即用的错误监控、性能采集、用户行为追踪功能，无需从零开发                      |
| **埋点数据服务** | 使用 heimdallr 官方服务端（基于 Node.js + PostgreSQL）                     | 官方提供 Docker 一键部署脚本，省去数据库设计和接口开发时间                       |
| **埋点平台**     | Ant Design Pro + 定制化埋点管理模块                                        | 复用其数据看板和管理界面模板，快速实现事件增删改查和 PV/UV 展示                  |
| **部署**         | Vercel（前端） + Railway（服务端）                                         | 免费、无需服务器运维，支持 GitHub 自动化部署                                 |

---

#### **二、开发流程（10 天）**
##### **Day 1-2：环境搭建与接口联调**
1. **克隆仓库**：
   ```bash
   # 前端（Ant Design Pro）
   git clone https://github.com/ant-design/ant-design-pro.git
   # 服务端（heimdallr-server）
   git clone https://github.com/heimdallr-sdk/server.git
   ```

2. **启动服务端**：
   ```bash
   cd server
   docker-compose up -d  # 依赖 Docker，自动启动 PostgreSQL 和接口服务
   ```

3. **SDK 接入 Demo**：
   ```html
   <!-- 在 HTML 中引入 heimdallr-sdk -->
   <script src="https://cdn.jsdelivr.net/npm/heimdallr-sdk@latest/dist/heimdallr.min.js"></script>
   <script>
     heimdallr.init({
       dsn: 'http://your-server-url/api/events', // 服务端上报地址
       appId: 'qxy-camp-project' // 青训营项目 ID
     });
   </script>
   ```

##### **Day 3-5：埋点平台开发（Ant Design Pro）**
1. **事件管理页面**：
   ```tsx
   // src/pages/EventManage.tsx
   import { ProTable } from '@ant-design/pro-components';
   import { getEvents } from '@/services/event';

   export default () => {
     return (
       <ProTable
         request={async (params) => {
           const res = await getEvents(params);
           return { data: res.data, success: true };
         }}
         columns={[
           { title: '事件名', dataIndex: 'name' },
           { title: '最近上报时间', dataIndex: 'timestamp' },
         ]}
       />
     );
   };
   ```

2. **数据看板页面**：
   ```tsx
   // src/pages/Dashboard.tsx
   import { Line } from '@ant-design/charts';
   import { getPVUV } from '@/services/analysis';

   export default () => {
     const { data } = useRequest(getPVUV);
     return (
       <Line
         data={data}
         xField="date"
         yField={['pv', 'uv']}
       />
     );
   };
   ```

##### **Day 6-7：联调与测试**
1. **Mock 数据**（前期开发用）：
   ```ts
   // src/services/event.ts
   export async function getEvents() {
     return Promise.resolve({
       data: [
         { name: 'click_event', timestamp: '2024-03-01' },
         { name: 'page_view', timestamp: '2024-03-02' },
       ],
     });
   }
   ```

2. **上报验证**：
   ```js
   // 在 Demo 页面手动触发事件
   document.getElementById('button').addEventListener('click', () => {
     heimdallr.sendEvent('button_click', { page: 'home' });
   });
   ```

##### **Day 8-10：部署与交付**
1. **前端部署（Vercel）**：
   - 将 Ant Design Pro 代码推送到 GitHub 仓库。
   - 登录 [Vercel](https://vercel.com)，导入仓库，一键部署。

2. **服务端部署（Railway）**：
   - 在 Railway 中新建 Project，选择 heimdallr-server 仓库。
   - 绑定 PostgreSQL 插件，自动配置环境变量。

3. **交付材料**：
   - 部署后的平台 URL（如 `https://qxy-track.vercel.app`）。
   - 埋点接入文档（1 页 Markdown 说明）。

---

#### **三、分工建议（4 人团队）**
| **成员** | **职责**                                                                 |
|----------|--------------------------------------------------------------------------|
| 成员 A   | 前端开发：Ant Design Pro 埋点管理页面、数据看板集成                        |
| 成员 B   | SDK 接入：Demo 页面埋点测试、heimdallr 配置                                |
| 成员 C   | 服务端部署：Docker 环境调试、Railway/Vercel 部署                           |
| 成员 D   | 文档 & 测试：编写接入文档、录制演示视频、基础功能验证                       |

---

#### **四、成本与资源**
| **项目**      | **明细**                                                                 |
|---------------|--------------------------------------------------------------------------|
| 开发成本      | 0 元（全部使用开源工具和免费部署平台）                                      |
| 服务器成本    | 0 元（Railway 免费版 5$/月额度，Vercel 免费）                              |
| 人力成本      | 4 人 × 10 天（轻度投入，每日 2-3 小时）                                     |

---

#### **五、注意事项**
1. **heimdallr 定制化**：
   - 若需修改 SDK 样式（如 UID 生成规则），直接编辑 `heimdallr-sdk/src/core/tracker.js`。
   - 重新构建 SDK：`npm run build`，替换 CDN 链接。

2. **数据持久化**：
   - Railway 的 PostgreSQL 免费版数据保留 7 天，**演示足够**。如需长期存储，导出 SQL 备份。

3. **快速扩展（加分项）**：
   - 在 Ant Design Pro 中添加 **“白屏检测”开关**（调用 heimdallr 的 `monitorBlankScreen()`）。
   - 在看板中增加 **“错误率”饼图**（复用 heimdallr 的错误日志接口）。

---

#### **六、最终交付效果**
- **前端平台**：  
  ![埋点管理界面](https://example.com/mock-dashboard.png)  
  （事件管理 + PV/UV 看板）

- **接入示例**：  
  ```js
  // 业务代码中埋点
  heimdallr.sendEvent('video_play', { duration: 120 });
  ```

- **演示视频**：  
  2 分钟演示：事件上报 → 平台展示 → 错误监控。

---

通过此方案，**无需编写复杂业务代码**，直接复用开源项目能力，2 周内即可交付一个完整可演示的埋点系统，且成本为 0，适合青训营项目快速拿分。