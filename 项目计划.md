---

### **极简版埋点系统方案：heimdallr-sdk（2 周内上线）**

---

#### **一、技术选型**
| **模块**        | **技术方案**                                                                 | **理由**                                                                 |
|-----------------|----------------------------------------------------------------------------|--------------------------------------------------------------------------|
| **埋点 SDK**     | 基于 [heimdallr-sdk](https://github.com/LuciferHuang/heimdallr-sdk) 开发    | 开箱即用的错误监控、性能采集、用户行为追踪功能，无需从零开发                      |
| **埋点数据服务** | 基于 heimdallr-sdk 服务端进行定制开发                                        | 提供完整的服务端实现，包含基础服务和消息队列版本                            |
| **埋点平台**     | 基于 heimdallr-sdk 管理平台进行定制开发                                      | 提供基础的管理界面，可在此基础上扩展事件管理和数据可视化                     |
| **部署**         | Docker Compose（本地开发）+ 云服务器（演示环境）                           | 开发环境使用Docker便于团队协作，演示使用云服务器更稳定                         |

---

#### **二、开发流程（10 天）**
##### **Day 1-3：环境搭建与功能测试**
1. **启动基础服务**：
   ```bash
   # 克隆heimdallr-sdk主仓库
   git clone https://github.com/LuciferHuang/heimdallr-sdk.git
   cd heimdallr-sdk

   # 启动服务端
   cd playground/server
   pnpm install
   pnpm run dev

   # 启动管理平台
   cd ../manager
   pnpm install
   pnpm run dev
   ```

2. **创建测试应用**：
   ```bash
   # 参考 mock_app 创建测试页面
   cd ../mock_app
   pnpm install
   pnpm run dev
   ```

##### **Day 4-6：功能优化与扩展**
1. **扩展管理平台功能**：
   - 添加自定义数据看板
   - 集成白屏检测和性能监控
   - 添加错误告警功能

2. **SDK 二次封装**：
   ```typescript
   // 封装通用参数
   class TrackSDK {
     init(config) {
       return init({
         ...config,
         beforeSend: (event) => {
           // 添加通用参数
           event.common = {
             userId: localStorage.getItem('userId'),
             projectId: 'qxy-camp'
           }
           return event
         }
       })
     }
   }
   ```

##### **Day 7-8：业务场景开发**
1. **电商演示场景**：
   ```typescript
   // 商品详情页埋点
   trackSDK.sendEvent('view_product', {
     productId: '123',
     price: 99.9,
     category: 'electronics'
   })

   // 下单事件埋点
   trackSDK.sendEvent('place_order', {
     orderId: 'ORDER_123',
     amount: 99.9,
     products: [{id: '123', quantity: 1}]
   })
   ```

##### **Day 9-10：部署与文档**
1. **服务部署**：
   - 使用Docker Compose打包服务
   - 部署到云服务器
   - 配置域名和HTTPS

2. **文档完善**：
   - 项目说明文档
   - 接入指南
   - 部署文档

---

#### **三、分工建议（4 人团队）**
| **成员** | **职责**                                                                 |
|----------|--------------------------------------------------------------------------|
| 成员 A   | SDK二次封装、业务场景开发                                                  |
| 成员 B   | 服务端部署、Docker环境配置                                                |
| 成员 C   | 管理平台功能扩展、告警功能                                                |
| 成员 D   | 文档编写、测试用例、演示视频                                              |

---

#### **四、成本与资源**
| **项目**      | **明细**                                                                 |
|---------------|--------------------------------------------------------------------------|
| 开发成本      | 0 元（全部使用开源工具和免费部署平台）                                      |
| 服务器成本    | 0 元（Railway 免费版 5$/月额度，Vercel 免费）                              |
| 人力成本      | 4 人 × 10 天（轻度投入，每日 2-3 小时）                                     |

---

#### **五、注意事项**
1. **heimdallr 定制化**：
   - 若需修改 SDK 样式（如 UID 生成规则），直接编辑 `heimdallr-sdk/src/core/tracker.js`。
   - 重新构建 SDK：`npm run build`，替换 CDN 链接。

2. **数据持久化**：
   - Railway 的 PostgreSQL 免费版数据保留 7 天，**演示足够**。如需长期存储，导出 SQL 备份。

3. **快速扩展（加分项）**：
   - 在 Ant Design Pro 中添加 **"白屏检测"开关**（调用 heimdallr 的 `monitorBlankScreen()`）。
   - 在看板中增加 **"错误率"饼图**（复用 heimdallr 的错误日志接口）。

---

#### **六、最终交付效果**
- **前端平台**：  
  ![埋点管理界面](https://example.com/mock-dashboard.png)  
  （事件管理 + PV/UV 看板）

- **接入示例**：  
  ```js
  // 业务代码中埋点
  heimdallr.sendEvent('video_play', { duration: 120 });
  ```

- **演示视频**：  
  2 分钟演示：事件上报 → 平台展示 → 错误监控。

---

通过此方案，**无需编写复杂业务代码**，直接复用开源项目能力，2 周内即可交付一个完整可演示的埋点系统，且成本为 0，适合青训营项目快速拿分。




# 项目详细建议
如果**核心目标**是「参加青训营项目并尽量拿奖」，那么你们在选用这样一套"极简版埋点系统"方案的同时，可以考虑在**项目呈现和功能体验**上做一些**锦上添花**的优化。这样既能凸显你们的方案**快速落地**的优点，也能在项目评分和展示时**脱颖而出**。以下是一些具体建议，供你们参考：

---

## 1. 让「极简版」看起来不那么简单：前端可视化和交互升级

1. **自定义仪表盘（Dashboard）布局**  
   - 目前很多开源看板都会采用固定布局 + 几个固定图表。  
   - 可以引入一个**拖拽式布局**（如 [react-grid-layout](https://github.com/react-grid-layout/react-grid-layout) 或类似功能），让用户可以**自由拖拽和缩放**图表组件，定制自己的数据看板。  
   - 这个功能很"炫"，在演示时能立刻抓住评委目光。

2. **丰富图表类型 & 多维度筛选**  
   - 在 Ant Design Pro 中，除了折线图/柱状图，可以额外加入**漏斗图**（Funnel）或**桑基图**（Sankey）之类，用来展示用户行为路径。  
   - 多维度筛选可以让用户在前端随时指定「时间范围、事件名称、来源渠道（params 中的channel）等」，实时刷新图表。  
   - 这些筛选选项可以用 ProForm 或自定义 Filter 表单形式，让可视化更灵活。

3. **实时刷新或可配置刷新**  
   - 利用 `setInterval` 或 WebSocket（可选） 做到"近实时"数据查看。  
   - 在演示中，你们可以手动触发事件上报，然后实时看到图表曲线发生变化，这种**即时反馈**能为项目加分不少。

---

## 2. 二次封装 heimdallr-sdk：表现出自研亮点

虽然你们用的是第三方 SDK，但还是可以做一些**二次封装**，增加差异化和技术深度：

1. **自定义事件上报方法**  
   - 对 `heimdallr.sendEvent(eventName, data)` 再包一层，比如 `trackPoint.sendEvent(eventName, data)`，在调用时自动补充「用户 ID、项目 ID、通用参数」。  
   - 这样就像你们自己"写"了个 SDK API，且在 demo/文档中展示「如何调用」，更符合青训营要求的**"可快速接入"**的概念。

2. **UID 生成和持久化**  
   - heimdallr 默认的用户识别可能是基于 `cookie` 或生成随机 UUID，你们可以添加**自定义逻辑**：如根据 localStorage 缓存、或关联到你们自定义的"用户系统"ID。  
   - 并在后端对应做**UV 去重**统计。  
   - 在青训营答辩（或文档）时，可以特别强调：**"我们实现了对 UV 的精确统计"**。

3. **白屏监控/性能监控整合**  
   - heimdallr 已经提供了简单的白屏检测、首屏性能采集等，你们可以直接把这个功能**集成到可视化平台**，在你们的 Dashboard 上做一个「白屏告警统计」或「页面加载时间分布图」。  
   - 这往往是基础埋点 SDK 不一定实现的，你们可以**突出**这点功能。

---

## 3. 加入简单的「报警 & 通知」机制

1. **错误报警**  
   - 比如如果某个错误在 5 分钟内出现超过 X 次，就通过「企业微信/钉钉/Webhook」给团队发消息。  
   - 这可以**利用 heimdallr-server 提供的错误数据**做一个定时任务（cron）或实时检测（webhook），然后你们自己封装一个「通知服务」，在平台上配置通知规则。  
   - 演示时，故意抛个错误，马上就能看到通知发到微信群组或钉钉群，**非常能体现实用价值**。

2. **指标监控**  
   - 类似地，可以对 PV/UV、点击转化率等做个阈值预警，一旦低于（或高于）某个数值就提醒。  
   - 即便是用**定时脚本 + Webhook**的方式都能完成，不需要写太多复杂逻辑，但演示效果很好。

---

## 4. 结合业务场景/实际案例，强化演示效果

1. **做一个真实的小 Demo 场景**  
   - 比如你们可以做个「简易电商/视频播放页面」，然后埋点"商品点击"、"下单支付"、"播放时长"等事件。  
   - 在可视化平台上，能看到**具体的业务指标**（比如"有多少人看了 30 秒以上的视频"、"有多少人在商品页停留了 1 分钟"），这比空泛的「click_event」更有说服力。  
   - 评委往往对"贴合真实业务、能直接落地"很买单。

2. **录制一段走查流程的视频**  
   - 从打开页面 → 触发事件 → 然后在看板看到数据变化 → 假设出现错误 → 后台收到了错误信息 → 平台报警。  
   - 整个流程**可视化**出来，给评委/观众一种**"这玩意真的跑起来了"**的观感。

---

## 5. 文档与项目展示包装：突出"为什么选这个方案 + 实际落地价值"

1. **对比方案**  
   - 简要说明你们为什么没有从零开发 SDK，而是**「取经 + 二次封装」**。  
   - 强调：**"我们在很短的时间内，已经验证了埋点能力，还能快速扩展。对于青训营的交付目标是最优解。"**  
   - 同时可以提出**后续演进**思路：当业务体量变大、要自定义更多场景时，怎么做**扩展或替换**。

2. **技术亮点**  
   - 把上面提到的任何「白屏监控、性能采集、报警机制、自定义 UID 识别、实时刷新」等功能**特别在文档和演示 PPT 中高亮**。  
   - 即使是借用开源项目，也可以通过「二次封装或优化」把亮点放大。

3. **对评分标准的对应表格**  
   - 青训营一般都会有评分细则（功能完整、代码质量、测试覆盖、性能等）。  
   - 你们可以针对这些项，**逐一给出对应的实现/说明**：  
     - 例如，"单元测试方面，我们对二次封装部分也做了 Jest 测试，覆盖率达到 xx%"。  
     - "性能方面，利用 Docker Compose + PostgreSQL + Redis（可选）保证了查询速度。"  
     - "错误捕获、白屏检测都已内置实现。"  
   - 让评委觉得你们**非常对症下药**，评分自然不会低。

---

## 6. 总结

- **核心策略**：**用最小工作量做一个可真实可视化、能完成基础埋点闭环的 Demo**，并在此基础上，"秀"出一些额外的**多维度数据分析、报警、白屏检测、实时刷新**等点睛之笔。  
- **包装**：前端可视化 + 演示数据流 + 自定义或扩展功能，能给评委留下「东西不只拿来就用，还进行了适当'魔改'、能真的帮业务做数据分析」的印象。  
- **落地性**：演示中无论是日志上报还是平台可视化，一定要**贴合实际业务场景**，避免只展示"空空的表格+图表"。真实事件名称、用户动作、错误信息等会让项目更具说服力。

只要你们**把这些"亮点"做扎实**，再配合简洁清晰的**文档和演示**，即便整体方案是"极简 + 开源"，也能达到一个**非常不错的效果**。这样在青训营的项目评比中，就有更大机会拿到优秀或高分奖项了。祝你们在青训营**一切顺利、拿到好成绩**！



：

1. **基础功能要求**：
   - 埋点SDK：heimdallr-sdk 完全满足要求，提供：
     - ✅ 事件上报
     - ✅ 页面初始化
     - ✅ 通用参数添加
     - ✅ 用户环境信息获取
     - ✅ 错误信息捕获

   - 埋点数据服务：heimdallr-sdk的server提供：
     - ✅ 完善的数据库结构
     - ✅ 合理的索引设计
     - ✅ 事件CRUD功能

   - 埋点平台：heimdallr-sdk的manager提供：
     - ✅ PV/UV数据查询
     - ✅ 事件管理
     - ✅ 数据筛选
     - ✅ 可视化图表

2. **进阶功能**：
   - ✅ 白屏监控
   - ✅ 数据查询优化
   - ✅ 看板搭建机制

3. **评分标准**：
   - 功能实现(60分)：完全满足基础功能要求
   - 代码质量(15分)：使用成熟的开源项目，代码质量有保证
   - SDK测试(15分)：需要我们对二次封装部分进行测试
   - 性能(10分)：heimdallr-sdk已经做了性能优化

4. **加分项**：
   - ✅ 完成部分进阶功能
   - ✅ 可以通过我们的扩展和优化添加更多功能
   - ✅ 可以优化平台交互设计

经过检查，我认为我们当前的方案完全符合项目要求，而且有以下优势：

1. 快速实现：使用成熟的heimdallr-sdk可以让我们快速搭建起基础功能
2. 稳定可靠：使用经过验证的开源项目，减少潜在问题
3. 可扩展性：我们可以在此基础上进行二次开发，添加更多功能
4. 符合评分标准：满足所有基础要求，并且有机会获得加分项

### 📝 当前项目结构
```
MarsCode_Winter_project/
├── server/              # 服务端
├── manager/             # 管理平台
├── mock_app/           # 测试应用
├── libs/               # SDK核心代码
├── docs/               # 文档
├── node_modules/       # Node.js依赖
├── package.json       # 项目配置
├── pnpm-lock.yaml    # 依赖锁定文件
├── README.md         # 项目说明
├── 项目计划.md        # 详细项目计划
└── 项目要求.md        # 原始项目要求
```

