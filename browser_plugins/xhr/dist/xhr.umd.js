!function(t,E){"object"==typeof exports&&"undefined"!=typeof module?module.exports=E(require("@heimdallr-sdk/utils")):"function"==typeof define&&define.amd?define(["@heimdallr-sdk/utils"],E):(t="undefined"!=typeof globalThis?globalThis:t||self).HEIMDALLR_XHR=E(t.utils)}(this,(function(t){"use strict";var E,e=((E=e||{}).NAME="@heimdallr-sdk",E),R=(t=>(t[t.FATAL=1]="FATAL",t[t.ERROR=2]="ERROR",t[t.WARN=3]="WARN",t[t.INFO=4]="INFO",t[t.DEBUG=5]="DEBUG",t))(R||{}),O=(t=>(t.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",t.USER_ID="HEIMDALLR_SDK_USER_ID",t.APP="HEIMDALLR_SDK_APP_ID",t))(O||{}),C=(t=>(t.GET="GET",t.POST="POST",t.PUT="PUT",t.DELETE="DELETE",t))(C||{}),r=(t=>(t[t.LIFECYCLE=1]="LIFECYCLE",t[t.ERROR=2]="ERROR",t[t.PERFORMANCE=3]="PERFORMANCE",t[t.API=4]="API",t[t.DOM=5]="DOM",t[t.ROUTE=6]="ROUTE",t[t.CONSOLE=7]="CONSOLE",t[t.RECORD=8]="RECORD",t[t.VUE=9]="VUE",t[t.CUSTOMER=10]="CUSTOMER",t[t.EXTEND=11]="EXTEND",t))(r||{}),o=(t=>(t[t.CODEERROR=21]="CODEERROR",t[t.RESOURCEERROR=22]="RESOURCEERROR",t[t.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",t[t.PAGECRASH=24]="PAGECRASH",t))(o||{}),s=(t=>(t[t.BEACON=1]="BEACON",t[t.IMG=2]="IMG",t[t.GET=3]="GET",t[t.POST=4]="POST",t))(s||{}),i=(t=>(t[t.CLICK=51]="CLICK",t))(i||{}),l=(t=>(t.LOG="log",t.INFO="info",t.WARN="warn",t.ERROR="error",t.ASSERT="assert",t))(l||{}),n=(t=>(t[t.XHR=41]="XHR",t[t.FETCH=42]="FETCH",t))(n||{}),S=(t=>(t[t.FMP=31]="FMP",t[t.FPS=32]="FPS",t[t.BASIC=33]="BASIC",t[t.VITALS=34]="VITALS",t[t.RESOURCE=35]="RESOURCE",t))(S||{}),L=(t=>(t[t.HASH=61]="HASH",t[t.HISTORY=62]="HISTORY",t))(L||{}),T=(t=>(t[t.CUSTOMER=111]="CUSTOMER",t))(T||{}),A=(t=>(t.LOCAL="local",t.SESSION="session",t.COOKIE="cookie",t.GLOBAL="global",t))(A||{}),I=(t=>(t[t.LOAD=11]="LOAD",t[t.UNLOAD=12]="UNLOAD",t))(I||{}),a=(t=>(t[t.MOBILE=1]="MOBILE",t[t.PC=2]="PC",t))(a||{}),p=(t=>(t[t.BROWSER=1]="BROWSER",t[t.WECHAT=2]="WECHAT",t[t.NODE=3]="NODE",t))(p||{}),U=(t=>(t[t.ROUTE=11]="ROUTE",t[t.CLICK=12]="CLICK",t[t.CONSOLE=13]="CONSOLE",t[t.XHR=14]="XHR",t[t.FETCH=15]="FETCH",t[t.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",t[t.RESOURCE=17]="RESOURCE",t[t.CODE_ERROR=18]="CODE_ERROR",t[t.CUSTOMER=19]="CUSTOMER",t[t.FRAMEWORK=20]="FRAMEWORK",t[t.LIFECYCLE=21]="LIFECYCLE",t[t.CRASH=22]="CRASH",t))(U||{}),D=(t=>(t[t.API=21]="API",t[t.ROUTE=22]="ROUTE",t[t.CLICK=23]="CLICK",t[t.ERROR=24]="ERROR",t[t.LIFECYCLE=25]="LIFECYCLE",t[t.CUSTOMER=26]="CUSTOMER",t))(D||{}),N=Object.defineProperty,c=Object.getOwnPropertySymbols,d=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,h=(t,E,e)=>E in t?N(t,E,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[E]=e,H=(t,E)=>{for(var e in E||(E={}))d.call(E,e)&&h(t,e,E[e]);if(c)for(var e of c(E))u.call(E,e)&&h(t,e,E[e]);return t};return function(E={}){const{ignoreUrls:e=[],reportResponds:O=!1}=E,C=XMLHttpRequest.prototype;return{name:"XHRPlugin",monitor(E){const{initUrl:R,uploadUrl:r}=this.getContext(),o=this,s=[...e,r,R].map((E=>t.getUrlPath(E)));t.replaceOld(C,"open",(t=>function(...E){this.httpCollect={req:{m:E[0]?E[0].toUpperCase():E[0],url:E[1]},res:{},t:o.getTime()},t.apply(this,E)})),t.replaceOld(C,"send",(e=>function(...R){const{req:C}=this.httpCollect,{url:r}=C;this.addEventListener("loadend",(function(){if(s.includes(t.getUrlPath(r)))return;const{responseType:e,response:i,status:l}=this;C.data=R[0];const n=o.getTime();O&&-1!==["","json","text"].indexOf(e)&&(this.httpCollect.res.dat="object"==typeof i?JSON.stringify(i):i),this.httpCollect.res.sta=l,this.httpCollect.et=n-this.httpCollect.t,E(this.httpCollect)})),e.apply(this,R)}))},transform(E){const e=t.generateUUID(),{req:{m:O,url:C,dat:o},et:s=0,res:{sta:i}}=E;return this.breadcrumb.unshift({lid:e,bt:U.XHR,l:200!=i?R.WARN:R.INFO,msg:`${O} "${C}" width "${JSON.stringify(o)}" took ${s} ms`,t:this.getTime()}),{lid:e,t:this.getTime(),e:r.API,dat:H({st:n.XHR},E)}}}}}));
