import{generateUUID as E,getStore as R,getCookie as O}from"@heimdallr-sdk/utils";var e,C=((e=C||{}).NAME="@heimdallr-sdk",e);var t=(E=>(E[E.FATAL=1]="FATAL",E[E.ERROR=2]="ERROR",E[E.WARN=3]="WARN",E[E.INFO=4]="INFO",E[E.DEBUG=5]="DEBUG",E))(t||{}),r=(E=>(E.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",E.USER_ID="HEIMDALLR_SDK_USER_ID",E.APP="HEIMDALLR_SDK_APP_ID",E))(r||{}),S=(E=>(E.GET="GET",E.POST="POST",E.PUT="PUT",E.DELETE="DELETE",E))(S||{}),a=(E=>(E[E.LIFECYCLE=1]="LIFECYCLE",E[E.ERROR=2]="ERROR",E[E.PERFORMANCE=3]="PERFORMANCE",E[E.API=4]="API",E[E.DOM=5]="DOM",E[E.ROUTE=6]="ROUTE",E[E.CONSOLE=7]="CONSOLE",E[E.RECORD=8]="RECORD",E[E.VUE=9]="VUE",E[E.CUSTOMER=10]="CUSTOMER",E[E.EXTEND=11]="EXTEND",E))(a||{}),n=(E=>(E[E.CODEERROR=21]="CODEERROR",E[E.RESOURCEERROR=22]="RESOURCEERROR",E[E.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",E[E.PAGECRASH=24]="PAGECRASH",E))(n||{}),o=(E=>(E[E.BEACON=1]="BEACON",E[E.IMG=2]="IMG",E[E.GET=3]="GET",E[E.POST=4]="POST",E))(o||{}),L=(E=>(E[E.CLICK=51]="CLICK",E))(L||{}),A=(E=>(E.LOG="log",E.INFO="info",E.WARN="warn",E.ERROR="error",E.ASSERT="assert",E))(A||{}),i=(E=>(E[E.XHR=41]="XHR",E[E.FETCH=42]="FETCH",E))(i||{}),I=(E=>(E[E.FMP=31]="FMP",E[E.FPS=32]="FPS",E[E.BASIC=33]="BASIC",E[E.VITALS=34]="VITALS",E[E.RESOURCE=35]="RESOURCE",E))(I||{}),l=(E=>(E[E.HASH=61]="HASH",E[E.HISTORY=62]="HISTORY",E))(l||{}),T=(E=>(E[E.CUSTOMER=111]="CUSTOMER",E))(T||{}),s=(E=>(E.LOCAL="local",E.SESSION="session",E.COOKIE="cookie",E.GLOBAL="global",E))(s||{}),D=(E=>(E[E.LOAD=11]="LOAD",E[E.UNLOAD=12]="UNLOAD",E))(D||{}),U=(E=>(E[E.MOBILE=1]="MOBILE",E[E.PC=2]="PC",E))(U||{}),N=(E=>(E[E.BROWSER=1]="BROWSER",E[E.WECHAT=2]="WECHAT",E[E.NODE=3]="NODE",E))(N||{}),d=(E=>(E[E.ROUTE=11]="ROUTE",E[E.CLICK=12]="CLICK",E[E.CONSOLE=13]="CONSOLE",E[E.XHR=14]="XHR",E[E.FETCH=15]="FETCH",E[E.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",E[E.RESOURCE=17]="RESOURCE",E[E.CODE_ERROR=18]="CODE_ERROR",E[E.CUSTOMER=19]="CUSTOMER",E[E.FRAMEWORK=20]="FRAMEWORK",E[E.LIFECYCLE=21]="LIFECYCLE",E[E.CRASH=22]="CRASH",E))(d||{}),H=(E=>(E[E.API=21]="API",E[E.ROUTE=22]="ROUTE",E[E.CLICK=23]="CLICK",E[E.ERROR=24]="ERROR",E[E.LIFECYCLE=25]="LIFECYCLE",E[E.CUSTOMER=26]="CUSTOMER",E))(H||{}),P=Object.defineProperty,c=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,F=(E,R,O)=>R in E?P(E,R,{enumerable:!0,configurable:!0,writable:!0,value:O}):E[R]=O,g=(E,R)=>{for(var O in R||(R={}))M.call(R,O)&&F(E,O,R[O]);if(c)for(var O of c(R))u.call(R,O)&&F(E,O,R[O]);return E};function p(e={}){const{pageCrashWorkerUrl:C}=e;return{name:"pageCrashPlugin",monitor(){if(Worker){if(!C)return void console.warn("[@heimdallr-sdk]:","Missing pageCrashWorkerUrl in options");const e=new Worker(C),{uploadUrl:t}=this.getContext(),S=E(),{userAgent:a,language:n}=navigator,{title:o,documentElement:L,body:A}=document,{href:i}=location,{innerWidth:I,innerHeight:l}=window,T={sendUrl:t,clientInfo:{aid:R(s.LOCAL,r.APP),sid:R(s.LOCAL,r.SESSION_ID),uid:O(r.USER_ID),p:N.BROWSER,ttl:o,url:i,lan:n,ua:a,ws:`${I}x${l}`,ds:`${L.clientWidth||A.clientWidth}x${L.clientHeight||A.clientHeight}`}},D=()=>{const[E]=this.breadcrumb.getStack();e.postMessage({type:"heartbeat",id:S,data:g({stack:[E]},T)})};window.addEventListener("beforeunload",(()=>{const[E]=this.breadcrumb.getStack();e.postMessage({type:"unload",id:S,data:g({stack:[E]},T)})})),setInterval(D,5e3),D()}}}}export{p as default};
