var HEIMDALLR_PERFORMANCE=function(){"use strict";var e,t=((e=t||{}).NAME="@heimdallr-sdk",e),n=(e=>(e[e.FATAL=1]="FATAL",e[e.ERROR=2]="ERROR",e[e.WARN=3]="WARN",e[e.INFO=4]="INFO",e[e.DEBUG=5]="DEBUG",e))(n||{}),r=(e=>(e.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",e.USER_ID="HEIMDALLR_SDK_USER_ID",e.APP="HEIMDALLR_SDK_APP_ID",e))(r||{}),i=(e=>(e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e))(i||{}),s=(e=>(e[e.LIFECYCLE=1]="LIFECYCLE",e[e.ERROR=2]="ERROR",e[e.PERFORMANCE=3]="PERFORMANCE",e[e.API=4]="API",e[e.DOM=5]="DOM",e[e.ROUTE=6]="ROUTE",e[e.CONSOLE=7]="CONSOLE",e[e.RECORD=8]="RECORD",e[e.VUE=9]="VUE",e[e.CUSTOMER=10]="CUSTOMER",e[e.EXTEND=11]="EXTEND",e))(s||{}),a=(e=>(e[e.CODEERROR=21]="CODEERROR",e[e.RESOURCEERROR=22]="RESOURCEERROR",e[e.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",e[e.PAGECRASH=24]="PAGECRASH",e))(a||{}),o=(e=>(e[e.BEACON=1]="BEACON",e[e.IMG=2]="IMG",e[e.GET=3]="GET",e[e.POST=4]="POST",e))(o||{}),E=(e=>(e[e.CLICK=51]="CLICK",e))(E||{}),c=(e=>(e.LOG="log",e.INFO="info",e.WARN="warn",e.ERROR="error",e.ASSERT="assert",e))(c||{}),R=(e=>(e[e.XHR=41]="XHR",e[e.FETCH=42]="FETCH",e))(R||{}),u=(e=>(e[e.FMP=31]="FMP",e[e.FPS=32]="FPS",e[e.BASIC=33]="BASIC",e[e.VITALS=34]="VITALS",e[e.RESOURCE=35]="RESOURCE",e))(u||{}),l=(e=>(e[e.HASH=61]="HASH",e[e.HISTORY=62]="HISTORY",e))(l||{}),O=(e=>(e[e.CUSTOMER=111]="CUSTOMER",e))(O||{}),C=(e=>(e.LOCAL="local",e.SESSION="session",e.COOKIE="cookie",e.GLOBAL="global",e))(C||{}),S=(e=>(e[e.LOAD=11]="LOAD",e[e.UNLOAD=12]="UNLOAD",e))(S||{}),f=(e=>(e[e.MOBILE=1]="MOBILE",e[e.PC=2]="PC",e))(f||{}),d=(e=>(e[e.BROWSER=1]="BROWSER",e[e.WECHAT=2]="WECHAT",e[e.NODE=3]="NODE",e))(d||{}),m=(e=>(e[e.ROUTE=11]="ROUTE",e[e.CLICK=12]="CLICK",e[e.CONSOLE=13]="CONSOLE",e[e.XHR=14]="XHR",e[e.FETCH=15]="FETCH",e[e.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",e[e.RESOURCE=17]="RESOURCE",e[e.CODE_ERROR=18]="CODE_ERROR",e[e.CUSTOMER=19]="CUSTOMER",e[e.FRAMEWORK=20]="FRAMEWORK",e[e.LIFECYCLE=21]="LIFECYCLE",e[e.CRASH=22]="CRASH",e))(m||{}),h=(e=>(e[e.API=21]="API",e[e.ROUTE=22]="ROUTE",e[e.CLICK=23]="CLICK",e[e.ERROR=24]="ERROR",e[e.LIFECYCLE=25]="LIFECYCLE",e[e.CUSTOMER=26]="CUSTOMER",e))(h||{}),T=(e=>(e.BASIC="basic",e.RESOURCE="resource",e.FMP="fmp",e.FPS="fps",e.VITALS="vitals",e))(T||{});const p=(e,t)=>!isFinite(e)||isNaN(e)||!Number.isInteger(t)||t<0?e:parseFloat(e.toFixed(t));var L,A,I=((L=I||{}).NAME="@heimdallr-sdk",L),v=((A=v||{})[A.FATAL=1]="FATAL",A[A.ERROR=2]="ERROR",A[A.WARN=3]="WARN",A[A.INFO=4]="INFO",A[A.DEBUG=5]="DEBUG",A),D=(e=>(e.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",e.USER_ID="HEIMDALLR_SDK_USER_ID",e.APP="HEIMDALLR_SDK_APP_ID",e))(D||{}),N=(e=>(e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e))(N||{}),M=(e=>(e[e.LIFECYCLE=1]="LIFECYCLE",e[e.ERROR=2]="ERROR",e[e.PERFORMANCE=3]="PERFORMANCE",e[e.API=4]="API",e[e.DOM=5]="DOM",e[e.ROUTE=6]="ROUTE",e[e.CONSOLE=7]="CONSOLE",e[e.RECORD=8]="RECORD",e[e.VUE=9]="VUE",e[e.CUSTOMER=10]="CUSTOMER",e[e.EXTEND=11]="EXTEND",e))(M||{}),F=(e=>(e[e.CODEERROR=21]="CODEERROR",e[e.RESOURCEERROR=22]="RESOURCEERROR",e[e.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",e[e.PAGECRASH=24]="PAGECRASH",e))(F||{}),P=(e=>(e[e.BEACON=1]="BEACON",e[e.IMG=2]="IMG",e[e.GET=3]="GET",e[e.POST=4]="POST",e))(P||{}),g=(e=>(e[e.CLICK=51]="CLICK",e))(g||{}),U=(e=>(e.LOG="log",e.INFO="info",e.WARN="warn",e.ERROR="error",e.ASSERT="assert",e))(U||{}),H=(e=>(e[e.XHR=41]="XHR",e[e.FETCH=42]="FETCH",e))(H||{}),w=(e=>(e[e.FMP=31]="FMP",e[e.FPS=32]="FPS",e[e.BASIC=33]="BASIC",e[e.VITALS=34]="VITALS",e[e.RESOURCE=35]="RESOURCE",e))(w||{}),y=(e=>(e[e.HASH=61]="HASH",e[e.HISTORY=62]="HISTORY",e))(y||{}),b=(e=>(e[e.CUSTOMER=111]="CUSTOMER",e))(b||{}),B=(e=>(e.LOCAL="local",e.SESSION="session",e.COOKIE="cookie",e.GLOBAL="global",e))(B||{}),x=(e=>(e[e.LOAD=11]="LOAD",e[e.UNLOAD=12]="UNLOAD",e))(x||{}),_=(e=>(e[e.MOBILE=1]="MOBILE",e[e.PC=2]="PC",e))(_||{}),G=(e=>(e[e.BROWSER=1]="BROWSER",e[e.WECHAT=2]="WECHAT",e[e.NODE=3]="NODE",e))(G||{}),W=(e=>(e[e.ROUTE=11]="ROUTE",e[e.CLICK=12]="CLICK",e[e.CONSOLE=13]="CONSOLE",e[e.XHR=14]="XHR",e[e.FETCH=15]="FETCH",e[e.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",e[e.RESOURCE=17]="RESOURCE",e[e.CODE_ERROR=18]="CODE_ERROR",e[e.CUSTOMER=19]="CUSTOMER",e[e.FRAMEWORK=20]="FRAMEWORK",e[e.LIFECYCLE=21]="LIFECYCLE",e[e.CRASH=22]="CRASH",e))(W||{}),K=(e=>(e[e.API=21]="API",e[e.ROUTE=22]="ROUTE",e[e.CLICK=23]="CLICK",e[e.ERROR=24]="ERROR",e[e.LIFECYCLE=25]="LIFECYCLE",e[e.CUSTOMER=26]="CUSTOMER",e))(K||{});var k,V,Y,X,J=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},q=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},j=function(e,t){var n=function n(r){"pagehide"!==r.type&&"hidden"!==document.visibilityState||(e(r),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},z=function(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)},$=function(e,t,n){var r;return function(i){t.value>=0&&(i||n)&&(t.delta=t.value-(r||0),(t.delta||void 0===r)&&(r=t.value,e(t)))}},Q=-1,Z=function(){return"hidden"===document.visibilityState?0:1/0},ee=function(){j((function(e){var t=e.timeStamp;Q=t}),!0)},te=function(){return Q<0&&(Q=Z(),ee(),z((function(){setTimeout((function(){Q=Z(),ee()}),0)}))),{get firstHiddenTime(){return Q}}},ne=function(e,t){var n,r=te(),i=J("FCP"),s=function(e){"first-contentful-paint"===e.name&&(o&&o.disconnect(),e.startTime<r.firstHiddenTime&&(i.value=e.startTime,i.entries.push(e),n(!0)))},a=window.performance&&performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],o=a?null:q("paint",s);(a||o)&&(n=$(e,i,t),a&&s(a),z((function(r){i=J("FCP"),n=$(e,i,t),requestAnimationFrame((function(){requestAnimationFrame((function(){i.value=performance.now()-r.timeStamp,n(!0)}))}))})))},re=!1,ie=-1,se=function(e,t){re||(ne((function(e){ie=e.value})),re=!0);var n,r=function(t){ie>-1&&e(t)},i=J("CLS",0),s=0,a=[],o=function(e){if(!e.hadRecentInput){var t=a[0],r=a[a.length-1];s&&e.startTime-r.startTime<1e3&&e.startTime-t.startTime<5e3?(s+=e.value,a.push(e)):(s=e.value,a=[e]),s>i.value&&(i.value=s,i.entries=a,n())}},E=q("layout-shift",o);E&&(n=$(r,i,t),j((function(){E.takeRecords().map(o),n(!0)})),z((function(){s=0,ie=-1,i=J("CLS",0),n=$(r,i,t)})))},ae={passive:!0,capture:!0},oe=new Date,Ee=function(e,t){k||(k=t,V=e,Y=new Date,ue(removeEventListener),ce())},ce=function(){if(V>=0&&V<Y-oe){var e={entryType:"first-input",name:k.type,target:k.target,cancelable:k.cancelable,startTime:k.timeStamp,processingStart:k.timeStamp+V};X.forEach((function(t){t(e)})),X=[]}},Re=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){Ee(e,t),i()},r=function(){i()},i=function(){removeEventListener("pointerup",n,ae),removeEventListener("pointercancel",r,ae)};addEventListener("pointerup",n,ae),addEventListener("pointercancel",r,ae)}(t,e):Ee(t,e)}},ue=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,Re,ae)}))},le=function(e,t){var n,r=te(),i=J("FID"),s=function(e){e.startTime<r.firstHiddenTime&&(i.value=e.processingStart-e.startTime,i.entries.push(e),n(!0))},a=q("first-input",s);n=$(e,i,t),a&&j((function(){a.takeRecords().map(s),a.disconnect()}),!0),a&&z((function(){var r;i=J("FID"),n=$(e,i,t),X=[],V=-1,k=null,ue(addEventListener),r=s,X.push(r),ce()}))},Oe={},Ce=function(e,t){var n,r=te(),i=J("LCP"),s=function(e){var t=e.startTime;t<r.firstHiddenTime&&(i.value=t,i.entries.push(e),n())},a=q("largest-contentful-paint",s);if(a){n=$(e,i,t);var o=function(){Oe[i.id]||(a.takeRecords().map(s),a.disconnect(),Oe[i.id]=!0,n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,o,{once:!0,capture:!0})})),j(o,!0),z((function(r){i=J("LCP"),n=$(e,i,t),requestAnimationFrame((function(){requestAnimationFrame((function(){i.value=performance.now()-r.timeStamp,Oe[i.id]=!0,n(!0)}))}))}))}};class Se{constructor(){this.lastFameTime=performance.now(),this.frame=0,this.fps=0,this.lastFameTime=performance.now()}run(){const e=performance.now(),t=e-this.lastFameTime;this.lastFameTime=e,this.fps=Math.round(1e3/t),this.frame++,e>1e3+this.lastTime&&(this.fps=Math.round(1e3*this.frame/(e-this.lastTime)),this.frame=0,this.lastTime=e),this.animationFramId=window.requestAnimationFrame((()=>{this.run()}))}get(){return p(this.fps,3)}destroy(){cancelAnimationFrame(this.animationFramId)}}const fe=["SCRIPT","STYLE","META","HEAD","LINK"],de={SVG:2,IMG:2,CANVAS:4,OBJECT:4,EMBED:4,VIDEO:4};class me{constructor(){const{responseEnd:e}=performance.timing;this.startTime=e,this.statusCollector=[],this.flag=!0,this.observer=null,this.callbackCount=1,this.resourceMap={},this.WW=window.innerWidth,this.WH=window.innerHeight}initObserver(){return new Promise((e=>{this.observer=new MutationObserver((()=>{const e=Date.now()-this.startTime,t=document.body;t&&this.doTag(t,this.callbackCount++),this.statusCollector.push({t:e})})),this.observer.observe(document,{childList:!0,subtree:!0}),"complete"===document.readyState?this.calFinallScore().then((t=>e(t))):window.addEventListener("load",(()=>{this.calFinallScore().then((t=>e(t)))}),!0)}))}getStyle(e,t){return window.getComputedStyle?window.getComputedStyle(e)[t]:e.currentStyle[t]}initResourceMap(){performance.getEntriesByType("resource").forEach((e=>{this.resourceMap[e.name]=e.responseEnd}))}doTag(e,t){const n=e.tagName;if(fe.includes(n))return;if((e.children?e.children.length:0)>0)for(const n of Array.from(e.children))null===n.getAttribute("f_c")&&n.setAttribute("f_c",`${t}`),this.doTag(n,t)}calFinallScore(){return new Promise((e=>{if(MutationObserver&&this.flag)if(this.checkCanCal(this.startTime)){this.observer.disconnect(),this.flag=!1;const t=this.deepTraversal(document.body);if(!t)return void e(null);let n=null;t.dpss.forEach((e=>{n&&n.st?n.st<e.st&&(n=e):n=e})),this.initResourceMap();const r=this.filterTheResultSet(n.els),i=this.calResult(r);e(p(i,3))}else setTimeout((()=>{this.calFinallScore().then((t=>{e(t)}))}),500);else e(null)}))}calResult(e){let t=0;return e.forEach((e=>{let n=0;const{node:r,weight:i}=e,{tagName:s}=r;if(1===i){const e=+r.getAttribute("f_c")-1;n=this.statusCollector[e].t}else if(2===i)switch(s){case"IMG":n=this.resourceMap[r.src];break;case"SVG":{const e=+r.getAttribute("f_c")-1;n=this.statusCollector[e].t}break;default:{const e=this.getStyle(r,"background-image").match(/url\("(.*?)"\)/);let t="";e&&e[1]&&(t=e[1]),-1==t.indexOf("http")&&(t=location.protocol+e[1]),n=this.resourceMap[t]}}else if(4===i)switch(s){case"CANVAS":{const e=+r.getAttribute("f_c")-1;n=this.statusCollector[e].t}break;case"VIDEO":{const e=r;n=this.resourceMap[e.src],!n&&(n=this.resourceMap[e.poster])}}t<n&&(t=n)})),t}filterTheResultSet(e){let t=0;e.forEach((e=>{t+=e.st}));const n=t/e.length;return e.filter((({st:e})=>e>=n))}deepTraversal(e){if(!e)return null;const t=[];for(let n,r=0;n=e.children[r];r++){const e=this.deepTraversal(n);e.st&&t.push(e)}return this.calScore(e,t)}calScore(e,t){const{width:n,height:r,left:i,top:s}=e.getBoundingClientRect();let a=1;(this.WH<s||this.WW<i)&&(a=0);let o=0;t.forEach((e=>{o+=e.st}));let E=de[e.tagName]||1;1!==E||["initial","none"].includes(this.getStyle(e,"background-image"))||(E=de.IMG);let c=n*r*E*a,R=[{node:e,st:c,weight:E}];const u=this.calAreaPercent(e);return(o>c*u||0===u)&&(c=o,R=[],t.forEach((e=>{R=R.concat(e.els)}))),{dpss:t,st:c,els:R}}checkCanCal(e){const t=Date.now()-e;return t>1e3||t-(this.statusCollector&&this.statusCollector.length&&this.statusCollector[this.statusCollector.length-1].t||0)>1e3}calAreaPercent(e){const{left:t,right:n,top:r,bottom:i,width:s,height:a}=e.getBoundingClientRect(),o=this.WW,E=this.WH,c=n-t+(o-0)-(Math.max(n,o)-Math.min(t,0));if(c<=0)return 0;const R=i-r+(E-0)-(Math.max(i,E)-Math.min(r,0));return R<=0?0:c*R/(s*a)}}var he=Object.defineProperty,Te=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,Le=Object.prototype.propertyIsEnumerable,Ae=(e,t,n)=>t in e?he(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ie=(e,t)=>{for(var n in t||(t={}))pe.call(t,n)&&Ae(e,n,t[n]);if(Te)for(var n of Te(t))Le.call(t,n)&&Ae(e,n,t[n]);return e};return function(e={}){const{performancOff:t=[]}=e;return{name:"perPlugin",monitor(e){const n=new Se;if(!t.includes(T.FMP)){(new me).initObserver().then((t=>{e({st:u.FMP,value:t})}))}t.includes(T.VITALS)||new Promise((e=>{Promise.all([new Promise((e=>{Ce((t=>{e(t.value)}))})),new Promise((e=>{le((t=>{e(t.value)}))})),new Promise((e=>{se((t=>{e(t.value)}))}))]).then((t=>{const[n,r,i]=t;e({lcp:p(n,3),fid:p(r,3),cls:p(i,3)})}))})).then((t=>{e(Ie({st:u.VITALS},t))})),window.addEventListener("load",(()=>{t.includes(T.BASIC)||e(Ie({st:u.BASIC},function(){const{domainLookupEnd:e,domainLookupStart:t,connectEnd:n,connectStart:r,secureConnectionStart:i,loadEventStart:s,domInteractive:a,domContentLoadedEventEnd:o,duration:E,responseStart:c,requestStart:R,responseEnd:u,fetchStart:l,transferSize:O,encodedBodySize:C,redirectEnd:S,redirectStart:f,redirectCount:d}=performance.getEntriesByType("navigation")[0],{startTime:m}=performance.getEntriesByType("paint").find((({name:e})=>"first-paint"===e))||{},{startTime:h}=performance.getEntriesByType("paint").find((({name:e})=>"first-contentful-paint"===e))||{};return{dnsSearch:p(e-t,3),tcpConnect:p(n-r,3),sslConnect:p(n-i,3),request:p(c-R,3),response:p(u-c,3),parseDomTree:p(a-u,3),resource:p(s-o,3),domReady:p(o-l,3),interactive:p(a-l,3),complete:p(s-l,3),httpHead:p(C-O,3),redirect:p(d,3),redirectTime:p(S-f,3),duration:p(E,3),fp:p(m,3),fcp:p(h,3)}}())),t.includes(T.RESOURCE)||e({st:u.RESOURCE,value:performance.getEntriesByType("resource").map((e=>({f:e.name,t:p(e.responseEnd,3)})))}),t.includes(T.FPS)||(n.run(),setTimeout((()=>{e({st:u.FPS,value:n.get()}),n.destroy()}),500))}),!0)},transform(e){return{lid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),t:this.getTime(),e:s.PERFORMANCE,dat:Ie({},e)}}}}}();
