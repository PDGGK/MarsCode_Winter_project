var HEIMDALLR_PAGE_CRASH_WORKER=function(e,t){"use strict";var s=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(e,t,r)=>t in e?s(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var s in t||(t={}))n.call(t,s)&&c(e,s,t[s]);if(a)for(var s of a(t))o.call(t,s)&&c(e,s,t[s]);return e},l=(e,t)=>r(e,i(t));return class{constructor(){this.CHECK_CRASH_INTERVAL=1e4,this.CRASH_THRESHOLD=15e3,this.pages={},this.timer=null,this.stack=[],console.info("[@heimdallr-sdk/page-crash-worker]:","webWorker running"),this.init()}init(){onmessage=e=>{const{id:t,type:s="",data:r={}}=e.data||{};switch(this.stack=r.stack||[],s){case"heartbeat":this.pages[t]={t:Date.now()},this.timer||(this.timer=setInterval((()=>{this.checkCrash(r)}),this.CHECK_CRASH_INTERVAL));break;case"unload":delete this.pages[t]}}}checkCrash(s){const r=Date.now(),{sendUrl:i,clientInfo:a}=s,n=a.url;for(const s in this.pages){if(r-this.pages[s].t>this.CRASH_THRESHOLD){delete this.pages[s];const r=[{id:s,bt:e.BrowserBreadcrumbTypes.CRASH,l:e.BreadcrumbLevel.FATAL,msg:`Crash on ${n}`,t:(new Date).getTime()},...this.stack];t.get(i,l(h({lid:s,t:(new Date).getTime(),e:e.EventTypes.ERROR,b:r},a),{dat:{st:e.BrowserErrorTypes.PAGECRASH,href:n}}))}}0==Object.keys(this.pages).length&&(clearInterval(this.timer),this.timer=null)}}}(types,utils);HEIMDALLR_PAGE_CRASH_WORKER&&new HEIMDALLR_PAGE_CRASH_WORKER;
