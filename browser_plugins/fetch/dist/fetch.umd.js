!function(E,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@heimdallr-sdk/utils")):"function"==typeof define&&define.amd?define(["@heimdallr-sdk/utils"],e):(E="undefined"!=typeof globalThis?globalThis:E||self).HEIMDALLR_FETCH=e(E.utils)}(this,(function(E){"use strict";var e,t=((e=t||{}).NAME="@heimdallr-sdk",e),R=(E=>(E[E.FATAL=1]="FATAL",E[E.ERROR=2]="ERROR",E[E.WARN=3]="WARN",E[E.INFO=4]="INFO",E[E.DEBUG=5]="DEBUG",E))(R||{}),O=(E=>(E.SESSION_ID="HEIMDALLR_SDK_SESSION_ID",E.USER_ID="HEIMDALLR_SDK_USER_ID",E.APP="HEIMDALLR_SDK_APP_ID",E))(O||{}),r=(E=>(E.GET="GET",E.POST="POST",E.PUT="PUT",E.DELETE="DELETE",E))(r||{}),C=(E=>(E[E.LIFECYCLE=1]="LIFECYCLE",E[E.ERROR=2]="ERROR",E[E.PERFORMANCE=3]="PERFORMANCE",E[E.API=4]="API",E[E.DOM=5]="DOM",E[E.ROUTE=6]="ROUTE",E[E.CONSOLE=7]="CONSOLE",E[E.RECORD=8]="RECORD",E[E.VUE=9]="VUE",E[E.CUSTOMER=10]="CUSTOMER",E[E.EXTEND=11]="EXTEND",E))(C||{}),s=(E=>(E[E.CODEERROR=21]="CODEERROR",E[E.RESOURCEERROR=22]="RESOURCEERROR",E[E.UNHANDLEDREJECTION=23]="UNHANDLEDREJECTION",E[E.PAGECRASH=24]="PAGECRASH",E))(s||{}),n=(E=>(E[E.BEACON=1]="BEACON",E[E.IMG=2]="IMG",E[E.GET=3]="GET",E[E.POST=4]="POST",E))(n||{}),o=(E=>(E[E.CLICK=51]="CLICK",E))(o||{}),i=(E=>(E.LOG="log",E.INFO="info",E.WARN="warn",E.ERROR="error",E.ASSERT="assert",E))(i||{}),S=(E=>(E[E.XHR=41]="XHR",E[E.FETCH=42]="FETCH",E))(S||{}),T=(E=>(E[E.FMP=31]="FMP",E[E.FPS=32]="FPS",E[E.BASIC=33]="BASIC",E[E.VITALS=34]="VITALS",E[E.RESOURCE=35]="RESOURCE",E))(T||{}),A=(E=>(E[E.HASH=61]="HASH",E[E.HISTORY=62]="HISTORY",E))(A||{}),L=(E=>(E[E.CUSTOMER=111]="CUSTOMER",E))(L||{}),I=(E=>(E.LOCAL="local",E.SESSION="session",E.COOKIE="cookie",E.GLOBAL="global",E))(I||{}),l=(E=>(E[E.LOAD=11]="LOAD",E[E.UNLOAD=12]="UNLOAD",E))(l||{}),a=(E=>(E[E.MOBILE=1]="MOBILE",E[E.PC=2]="PC",E))(a||{}),D=(E=>(E[E.BROWSER=1]="BROWSER",E[E.WECHAT=2]="WECHAT",E[E.NODE=3]="NODE",E))(D||{}),U=(E=>(E[E.ROUTE=11]="ROUTE",E[E.CLICK=12]="CLICK",E[E.CONSOLE=13]="CONSOLE",E[E.XHR=14]="XHR",E[E.FETCH=15]="FETCH",E[E.UNHANDLEDREJECTION=16]="UNHANDLEDREJECTION",E[E.RESOURCE=17]="RESOURCE",E[E.CODE_ERROR=18]="CODE_ERROR",E[E.CUSTOMER=19]="CUSTOMER",E[E.FRAMEWORK=20]="FRAMEWORK",E[E.LIFECYCLE=21]="LIFECYCLE",E[E.CRASH=22]="CRASH",E))(U||{}),N=(E=>(E[E.API=21]="API",E[E.ROUTE=22]="ROUTE",E[E.CLICK=23]="CLICK",E[E.ERROR=24]="ERROR",E[E.LIFECYCLE=25]="LIFECYCLE",E[E.CUSTOMER=26]="CUSTOMER",E))(N||{}),d=Object.defineProperty,u=Object.defineProperties,c=Object.getOwnPropertyDescriptors,H=Object.getOwnPropertySymbols,P=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable,F=(E,e,t)=>e in E?d(E,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):E[e]=t,p=(E,e)=>{for(var t in e||(e={}))P.call(e,t)&&F(E,t,e[t]);if(H)for(var t of H(e))f.call(e,t)&&F(E,t,e[t]);return E};return function(e={}){const{ignoreUrls:t=[],reportResponds:O=!1}=e;return{name:"fetchPlugin",monitor(e){const{initUrl:R,uploadUrl:C}=this.getContext(),s=this,n=[...t,C,R].map((e=>E.getUrlPath(e)));E.replaceOld(window,"fetch",(t=>function(R,C={}){const o=s.getTime(),i={req:{url:R,m:C&&C.method||r.GET,dat:C&&C.body},t:o,res:{}},S=new Headers(C.headers||{});var T;Object.assign(S,{setRequestHeader:S.set}),T=p({},C),C=u(T,c({headers:S}));const A=n.includes(E.getUrlPath(R));return t.apply(window,[R,C]).then((E=>{const t=E.clone(),R=s.getTime();return i.et=R-o,i.res.sta=t.status,t.text().then((E=>{A||(O&&(i.res.dat=E),e(i))})),E}),(E=>{if(A)return;const t=s.getTime();throw i.et=t-o,i.res.sta=0,e(i),E}))}))},transform(e){const t=E.generateUUID(),{req:{m:O,url:r,dat:s},et:n=0,res:{sta:o}}=e;return this.breadcrumb.unshift({lid:t,bt:U.FETCH,l:200!=o?R.WARN:R.INFO,msg:`${O} "${r}" width "${JSON.stringify(s)}" took ${n} ms`,t:this.getTime()}),{lid:t,t:this.getTime(),e:C.API,dat:p({st:S.FETCH},e)}}}}}));
